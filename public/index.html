<script>
  const apiBaseUrl = 'https://gdgoc-e3r25jhmn-blacknwhite03s-projects.vercel.app/api';

  // Create new book
  document.getElementById('create-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const data = {
          id: null,
          title: document.getElementById('create-title').value,
          author: document.getElementById('create-author-name').value,
          published_at: document.getElementById('create-publish-date').value
      };

      const response = await fetch(`${apiBaseUrl}/books`, {
          method: 'POST',
          headers: { 
              'Content-Type': 'application/json',
              // Tambahkan header lain jika perlu
          },
          body: JSON.stringify(data)
      });

      if (response.ok) {
          alert('Buku berhasil ditambahkan!');
          e.target.reset();
          fetchBooks();
          console.log('Buku berhasil ditambahkan');
      } else {
          alert('Gagal menambahkan buku');
      }
  });

  // Fetch all books
  async function fetchBooks() {
      const response = await fetch(`${apiBaseUrl}/books`);
      if (response.ok) {
          const responseData = await response.json();
          const books = responseData.data; 
          const tableBody = document.getElementById('books-table');
          tableBody.innerHTML = ''; 

          books.forEach(book => {
              const row = document.createElement('tr');
              row.innerHTML = 
              ` <td>${book.id}</td>
                  <td>${book.title}</td>
                  <td>${book.author}</td>
                  <td>${book.published_at}</td> `;
              tableBody.appendChild(row);
          });
      } else {
          alert('Gagal mengambil data buku');
      }
  }

  document.getElementById('refresh-button').addEventListener('click', fetchBooks);

  // Update book
  document.getElementById('update-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const bookId = document.getElementById('update-book-id').value;
      
      const data = {
          title: document.getElementById('update-book-name').value || null,
          author: document.getElementById('update-author-name').value || null,
          published_at: document.getElementById('update-publish-date').value || null
      };

      const response = await fetch(`${apiBaseUrl}/books/${bookId}`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
      });

      if (response.ok) {
          alert('Buku berhasil diupdate');
          e.target.reset();
          fetchBooks();
      } else {
          alert('Gagal mengupdate buku');
      }
  });

  // Delete book
  document.getElementById('delete-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const bookId = document.getElementById('delete-book-id').value;
      const response = await fetch(`${apiBaseUrl}/books/${bookId}`, { method: 'DELETE' });
      
      if (response.ok) {
          alert('Buku berhasil dihapus');
          e.target.reset();
          fetchBooks();
      } else {
          alert('Gagal menghapus buku');
      }
  });

  fetchBooks();
</script>
